<% rates_array = [] %>
<% rank_array = [] %>
<% users.each_with_index do |user, i| %>
  <% if rates_array.last == user.highest_rate %>
    <% i = rank_array.last %>
  <% else %>
    <% i = rank_array.count + 1 %>
  <% end %>
  <% rates_array << user.highest_rate %>
  <% rank_array << i %>
  <% if user.id == current_user.id %>
    <li class="record" style="color:red;">
      <div><%= i %>位</div>
      <div><%= user.name %></div>
      <div><%= user.highest_rate %>%</div>
    </li>
  <% else %>
    <li class="record">
      <div><%= i %>位</div>
      <div><%= user.name %></div>
      <div><%= user.highest_rate %>%</div>
    </li>
  <% end %>
<% end %>
